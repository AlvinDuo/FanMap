# æ™¯é»ç®¡ç†ç³»çµ±å¾Œç«¯è¨­ç½®æŒ‡å—

## ğŸ¯ é …ç›®æ¦‚è¿°

é€™æ˜¯ä¸€å€‹åŸºæ–¼ NestJS çš„æ™¯é»ç®¡ç†ç³»çµ±å¾Œç«¯ï¼Œå¯¦ç¾äº†å®Œæ•´çš„ RBAC æ¬Šé™æ§åˆ¶ã€JWT èªè­‰ã€æ™¯é»ç®¡ç†å’Œç”³è«‹å¯©æ ¸åŠŸèƒ½ã€‚

## ğŸ“ é …ç›®çµæ§‹

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”œâ”€â”€ auth/           # èªè­‰æ¨¡çµ„ (JWT, ç™»å…¥è¨»å†Š)
â”‚   â”‚   â”œâ”€â”€ users/          # ä½¿ç”¨è€…ç®¡ç†æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ sites/          # æ™¯é»ç®¡ç†æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ submissions/    # æ™¯é»ç”³è«‹æ¨¡çµ„
â”‚   â”‚   â””â”€â”€ dashboard/      # å„€è¡¨æ¿çµ±è¨ˆæ¨¡çµ„
â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”œâ”€â”€ guards/         # æ¬Šé™å®ˆè¡›
â”‚   â”‚   â”œâ”€â”€ decorators/     # è‡ªè¨‚è£é£¾å™¨
â”‚   â”‚   â”œâ”€â”€ filters/        # ç•°å¸¸éæ¿¾å™¨
â”‚   â”‚   â””â”€â”€ interfaces/     # ä»‹é¢å®šç¾©
â”‚   â”œâ”€â”€ prisma/             # Prisma æœå‹™
â”‚   â”œâ”€â”€ main.ts             # æ‡‰ç”¨ç¨‹å¼å…¥å£
â”‚   â””â”€â”€ app.module.ts       # ä¸»æ¨¡çµ„
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma       # è³‡æ–™åº« Schema
â”œâ”€â”€ .env.example            # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â””â”€â”€ README.md
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. å®‰è£ä¾è³´
```bash
npm install
```

### 2. è¨­ç½®ç’°å¢ƒè®Šæ•¸
```bash
cp .env.example .env
```

ç·¨è¼¯ `.env` æ–‡ä»¶ï¼š
```env
DATABASE_URL="postgresql://username:password@localhost:5432/site_management?schema=public"
JWT_SECRET="your-super-secret-jwt-key-change-this-in-production"
JWT_EXPIRES_IN="1h"
PORT=3000
NODE_ENV="development"
CORS_ORIGIN="http://localhost:3000,https://yourdomain.github.io"
```

### 3. è¨­ç½®è³‡æ–™åº«
```bash
# ç”Ÿæˆ Prisma å®¢æˆ¶ç«¯
npm run prisma:generate

# åŸ·è¡Œè³‡æ–™åº«é·ç§»
npm run prisma:migrate
```

### 4. å•Ÿå‹•é–‹ç™¼æœå‹™å™¨
```bash
npm run start:dev
```

## ğŸ“Š è³‡æ–™åº«è¨­è¨ˆ

### User (ä½¿ç”¨è€…)
- `id`: ä¸»éµ
- `email`: å”¯ä¸€éƒµç®±
- `password`: åŠ å¯†å¯†ç¢¼
- `role`: è§’è‰² (USER/ADMIN)

### Site (æ™¯é»)
- `id`: ä¸»éµ
- `name`: æ™¯é»åç¨±
- `description`: æ™¯é»æè¿°
- `location`: GeoJSON ä½ç½®è³‡æ–™
- `status`: ç‹€æ…‹ (PENDING/APPROVED/REJECTED)
- `createdById`: å‰µå»ºè€… ID

### Submission (ç”³è«‹)
- `id`: ä¸»éµ
- `siteData`: ç”³è«‹çš„æ™¯é»è³‡æ–™ (JSON)
- `status`: ç”³è«‹ç‹€æ…‹
- `submittedById`: ç”³è«‹è€… ID
- `reviewedById`: å¯©æ ¸è€… ID

## ğŸ” æ¬Šé™è¨­è¨ˆ

### è§’è‰²æ¬Šé™
- **USER**: å¯ä»¥å‰µå»ºæ™¯é»ã€æäº¤ç”³è«‹ã€æŸ¥çœ‹è‡ªå·±çš„ç”³è«‹
- **ADMIN**: æ“æœ‰æ‰€æœ‰æ¬Šé™ï¼Œå¯ä»¥å¯©æ ¸ç”³è«‹ã€ç®¡ç†ä½¿ç”¨è€…

### API æ¬Šé™æ§åˆ¶
- ä½¿ç”¨ `@Roles()` è£é£¾å™¨æ¨™è¨˜éœ€è¦çš„è§’è‰²
- `JwtAuthGuard` é©—è­‰ JWT Token
- `RolesGuard` æª¢æŸ¥ä½¿ç”¨è€…è§’è‰²æ¬Šé™

## ğŸ“¡ ä¸»è¦ API ç«¯é»

### èªè­‰
- `POST /auth/login` - ä½¿ç”¨è€…ç™»å…¥
- `POST /auth/register` - ä½¿ç”¨è€…è¨»å†Š

### æ™¯é»ç®¡ç†
- `GET /sites` - å–å¾—å·²å¯©æ ¸é€šéçš„æ™¯é» (å…¬é–‹)
- `POST /sites` - å‰µå»ºæ™¯é» (éœ€ç™»å…¥)
- `PATCH /sites/:id/status` - æ›´æ–°æ™¯é»ç‹€æ…‹ (åƒ…ç®¡ç†å“¡)

### ç”³è«‹ç®¡ç†
- `POST /submissions` - æäº¤æ™¯é»ç”³è«‹ (éœ€ç™»å…¥)
- `GET /submissions` - æŸ¥çœ‹æ‰€æœ‰ç”³è«‹ (åƒ…ç®¡ç†å“¡)
- `PATCH /submissions/:id` - å¯©æ ¸ç”³è«‹ (åƒ…ç®¡ç†å“¡)

### ä½¿ç”¨è€…ç®¡ç†
- `GET /users` - å–å¾—ä½¿ç”¨è€…åˆ—è¡¨ (åƒ…ç®¡ç†å“¡)
- `POST /users` - å‰µå»ºä½¿ç”¨è€… (åƒ…ç®¡ç†å“¡)

### å„€è¡¨æ¿
- `GET /dashboard/stats` - å–å¾—çµ±è¨ˆè³‡æ–™ (åƒ…ç®¡ç†å“¡)
- `GET /dashboard/activity` - å–å¾—æœ€è¿‘æ´»å‹• (åƒ…ç®¡ç†å“¡)

## ğŸ›  æŠ€è¡“ç‰¹è‰²

### 1. çµ±ä¸€ API å›æ‡‰æ ¼å¼
```json
{
  "success": true,
  "message": "æ“ä½œæˆåŠŸ",
  "data": { ... }
}
```

### 2. å…¨åŸŸç•°å¸¸è™•ç†
- è‡ªå‹•æ•ç²ä¸¦æ ¼å¼åŒ–éŒ¯èª¤å›æ‡‰
- é–‹ç™¼ç’°å¢ƒé¡¯ç¤ºéŒ¯èª¤å †ç–Š
- çµæ§‹åŒ–æ—¥èªŒè¼¸å‡º

### 3. è«‹æ±‚é©—è­‰
- ä½¿ç”¨ `class-validator` é€²è¡Œ DTO é©—è­‰
- è‡ªå‹•è½‰æ›å’Œæ¸…ç†è¼¸å…¥è³‡æ–™

### 4. Swagger æ–‡æª”
- è‡ªå‹•ç”Ÿæˆ API æ–‡æª”
- è¨ªå• `http://localhost:3000/api`

## ğŸ§ª æ¸¬è©¦

```bash
# å–®å…ƒæ¸¬è©¦
npm run test

# æ¸¬è©¦è¦†è“‹ç‡
npm run test:cov

# E2E æ¸¬è©¦
npm run test:e2e
```

## ğŸ“¦ éƒ¨ç½²

### ç”Ÿç”¢ç’°å¢ƒæ§‹å»º
```bash
npm run build
npm run start:prod
```

### ç’°å¢ƒè®Šæ•¸è¨­ç½®
ç¢ºä¿åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­è¨­ç½®ï¼š
- `DATABASE_URL`: ç”Ÿç”¢è³‡æ–™åº«é€£æ¥
- `JWT_SECRET`: å¼·å¯†ç¢¼ JWT å¯†é‘°
- `NODE_ENV=production`
- `CORS_ORIGIN`: å…è¨±çš„å‰ç«¯åŸŸå

## ğŸ”§ é–‹ç™¼å·¥å…·

- **ESLint**: ä»£ç¢¼æª¢æŸ¥
- **Prettier**: ä»£ç¢¼æ ¼å¼åŒ–
- **Prisma Studio**: è³‡æ–™åº«ç®¡ç†ç•Œé¢
- **Jest**: æ¸¬è©¦æ¡†æ¶

## ğŸ“ ä¸‹ä¸€æ­¥

1. è¨­ç½®è³‡æ–™åº«é€£æ¥
2. é‹è¡Œé·ç§»å‰µå»ºè¡¨çµæ§‹
3. å‰µå»ºç®¡ç†å“¡å¸³æˆ¶
4. æ¸¬è©¦ API ç«¯é»
5. éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ

## ğŸ‰ å®Œæˆç‹€æ…‹

âœ… **å·²å®ŒæˆåŠŸèƒ½**ï¼š
- JWT èªè­‰ç³»çµ±
- RBAC æ¬Šé™æ§åˆ¶
- æ™¯é» CRUD æ“ä½œ
- ç”³è«‹å¯©æ ¸æµç¨‹
- ä½¿ç”¨è€…ç®¡ç†
- å„€è¡¨æ¿çµ±è¨ˆ
- API æ–‡æª”
- å…¨åŸŸç•°å¸¸è™•ç†
- è«‹æ±‚é©—è­‰
- åŸºç¤æ¸¬è©¦

ğŸ”„ **å¯æ“´å±•åŠŸèƒ½**ï¼š
- æª”æ¡ˆä¸Šå‚³ (æ™¯é»åœ–ç‰‡)
- éƒµä»¶é€šçŸ¥
- å¿«å–æ©Ÿåˆ¶
- æ—¥èªŒç›£æ§
- å¤šèªç³»æ”¯æ´
- API é™æµ